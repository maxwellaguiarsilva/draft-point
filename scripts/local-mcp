#!/bin/bash

venv_dir="./scripts/venv-fast-mcp"
python_script="local-mcp.py"

#	check if the virtual environment exists
if [[ ! -d "${venv_dir}" ]];
then
	echo "creating virtual environment in ${venv_dir}..."
	if ! python3 -m venv "${venv_dir}";
	then
		echo "failed to create virtual environment"
		exit 1
	fi
fi

#	activate the virtual environment
#	shellcheck disable=SC1091
source "${venv_dir}/bin/activate"

#	install dependencies if not already installed
#	we assume fastmcp is the only external dependency
if ! "${venv_dir}/bin/pip" show fastmcp &>/dev/null;
then
	echo "installing fastmcp..."
	if ! "${venv_dir}/bin/pip" install fastmcp;
	then
		echo "failed to install fastmcp"
		deactivate #	deactivate venv before exiting
		exit 1
	fi
fi

#	execute the original python script with all arguments
"${python_script}" "${@}"

#	deactivate the virtual environment
deactivate
